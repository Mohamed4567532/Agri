<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mes Réclamations - AgriSmart</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/reclamations.css">
</head>

<body class="farmer-no-bg">
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="logo">
                <img src="assets/img/logo.PNG" alt="AgriSmart Logo">
                <span>AgriSmart</span>
            </a>
            <ul class="nav-menu" id="navMenu">
                <li><a href="index.html">
                        <span class="nav-icon"><svg viewBox="0 0 24 24">
                                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                                <polyline points="9 22 9 12 15 12 15 22" />
                            </svg></span>
                        Accueil
                    </a></li>
                <li><a href="reclamations.html" class="active">
                        <span class="nav-icon"><svg viewBox="0 0 24 24">
                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" />
                                <polyline points="22,6 12,13 2,6" />
                            </svg></span>
                        Mes Réclamations
                    </a></li>
                <li><a href="#" onclick="logout(); return false;">
                        <span class="nav-icon"><svg viewBox="0 0 24 24">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                                <polyline points="16 17 21 12 16 7" />
                                <line x1="21" y1="12" x2="9" y2="12" />
                            </svg></span>
                        Déconnexion
                    </a></li>
            </ul>

        </div>
    </nav>

    <div class="container">
        <div class="reclamations-container">
            <!-- Header moderne -->
            <div class="reclamations-header">
                <h1><i class="fa-solid fa-file-circle-exclamation"></i> Mes Réclamations</h1>
                <p>Créez une nouvelle réclamation ou consultez le statut de vos réclamations existantes</p>
            </div>

            <!-- Bouton d'action -->
            <div class="reclamations-actions">
                <button type="button" id="newReclamationBtn"
                    onclick="event.preventDefault(); event.stopPropagation(); console.log('CLIC DETECTE'); document.getElementById('newReclamationModal').style.display='flex'; document.getElementById('newReclamationModal').classList.add('active');">
                    Nouvelle Réclamation
                </button>
            </div>

            <!-- Liste des réclamations -->
            <div id="reclamationsList" class="reclamations-list">
                <p class="reclamations-loading">Chargement de vos réclamations...</p>
            </div>
        </div>
    </div>

    <!-- Modal Nouvelle Réclamation -->
    <div id="newReclamationModal" class="modal" onclick="if(event.target === this) closeNewReclamationModal();">
        <div class="modal-content reclamation-modal-content" onclick="event.stopPropagation();">
            <div class="modal-header reclamation-modal-header">
                <h2><i class="fa-solid fa-plus-circle"></i> Nouvelle Réclamation</h2>
                <button class="close reclamation-modal-close" id="closeReclamationModal" onclick="closeNewReclamationModal(); return false;">&times;</button>
            </div>
            <div class="modal-body">
                <form id="newReclamationForm"
                    onsubmit="event.preventDefault(); createReclamation(event); return false;">
                    <div class="form-group reclamation-form-group">
                        <label class="reclamation-form-label">Sujet *</label>
                        <input type="text" id="reclamationSujet" class="form-control reclamation-form-input" required
                            placeholder="Ex: Problème avec un produit">
                    </div>
                    <div class="form-group reclamation-form-group">
                        <label class="reclamation-form-label">Type</label>
                        <select id="reclamationType" class="form-control reclamation-form-select">
                            <option value="technique">Technique</option>
                            <option value="produit">Produit</option>
                            <option value="service">Service</option>
                            <option value="autre">Autre</option>
                        </select>
                    </div>
                    <div class="form-group reclamation-form-group">
                        <label class="reclamation-form-label">Description *</label>
                        <textarea id="reclamationDescription" class="form-control reclamation-form-textarea" required rows="5"
                            placeholder="Décrivez votre réclamation en détail..."></textarea>
                    </div>
                    <div class="reclamation-form-actions">
                        <button type="submit" id="submitReclamationBtn" class="btn btn-primary reclamation-btn-submit">
                            <i class="fa-solid fa-paper-plane"></i> Envoyer
                        </button>
                        <button type="button" class="btn btn-secondary reclamation-btn-cancel" id="cancelReclamationBtn"
                            onclick="closeNewReclamationModal(); return false;">Annuler</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Modifier Réclamation -->
    <div id="editReclamationModal" class="modal" onclick="if(event.target === this) closeEditReclamationModal();">
        <div class="modal-content reclamation-modal-content" onclick="event.stopPropagation();">
            <div class="modal-header reclamation-modal-header">
                <h2><i class="fa-solid fa-pen-to-square"></i> Modifier la Réclamation</h2>
                <button class="close reclamation-modal-close" onclick="closeEditReclamationModal(); return false;">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editReclamationForm" onsubmit="event.preventDefault(); updateReclamation(event); return false;">
                    <input type="hidden" id="editReclamationId">
                    <div class="form-group reclamation-form-group">
                        <label class="reclamation-form-label">Sujet *</label>
                        <input type="text" id="editReclamationSujet" class="form-control reclamation-form-input" required
                            placeholder="Ex: Problème avec un produit">
                    </div>
                    <div class="form-group reclamation-form-group">
                        <label class="reclamation-form-label">Type</label>
                        <select id="editReclamationType" class="form-control reclamation-form-select">
                            <option value="technique">Technique</option>
                            <option value="produit">Produit</option>
                            <option value="service">Service</option>
                            <option value="autre">Autre</option>
                        </select>
                    </div>
                    <div class="form-group reclamation-form-group">
                        <label class="reclamation-form-label">Description *</label>
                        <textarea id="editReclamationDescription" class="form-control reclamation-form-textarea" required rows="5"
                            placeholder="Décrivez votre réclamation en détail..."></textarea>
                    </div>
                    <div class="reclamation-form-actions">
                        <button type="submit" class="btn btn-primary reclamation-btn-submit">
                            <i class="fa-solid fa-save"></i> Enregistrer
                        </button>
                        <button type="button" class="btn btn-secondary reclamation-btn-cancel" onclick="closeEditReclamationModal(); return false;">Annuler</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="assets/js/main.js"></script>
    <script src="assets/js/api.js"></script>
    <script src="assets/js/auth.js"></script>
    <script src="assets/js/reclamations.js"></script>

    <script>
        // Script de test pour vérifier que tout fonctionne
        console.log('Script de test chargé');

        // Fonction simple pour ouvrir le modal
        function openModalDirect() {
            console.log('openModalDirect appelée');
            const modal = document.getElementById('newReclamationModal');
            if (modal) {
                modal.style.display = 'flex';
                modal.classList.add('active');
                console.log('Modal ouvert directement');
            } else {
                alert('Modal non trouvé');
            }
        }

        window.openModalDirect = openModalDirect;

        document.addEventListener('DOMContentLoaded', function () {
            console.log('✅ Page chargée - DOMContentLoaded');

            // Vérifier que le bouton existe
            const btn = document.getElementById('newReclamationBtn');
            if (btn) {
                console.log('✅ Bouton trouvé dans le DOM');

                // Ajouter plusieurs event listeners
                btn.onclick = function (e) {
                    console.log('ONCLICK DIRECT - Clic détecté!');
                    e.preventDefault();
                    e.stopPropagation();
                    openModalDirect();
                };

                btn.addEventListener('click', function (e) {
                    console.log('ADD EVENT LISTENER - Clic détecté!');
                    e.preventDefault();
                    e.stopPropagation();
                    openModalDirect();
                }, true);

                console.log('✅ Event listeners ajoutés au bouton');
            } else {
                console.error('❌ Bouton non trouvé dans le DOM');
            }

            // Vérifier que le modal existe
            const modal = document.getElementById('newReclamationModal');
            if (modal) {
                console.log('✅ Modal trouvé dans le DOM');
            } else {
                console.error('❌ Modal non trouvé dans le DOM');
            }
        });

        // Appliquer le style selon le rôle de l'utilisateur
        function applyUserStyle() {
            const user = getCurrentUser();
            console.log('User detected:', user);
            if (user && user.role === 'consumer') {
                console.log('Applying consumer style...');
                document.body.classList.remove('farmer-no-bg');
                document.body.classList.add('consumer-page');
            } else if (user && user.role === 'vet') {
                console.log('Applying vet style...');
                document.body.classList.remove('farmer-no-bg');
                document.body.classList.add('vet-page');
            }
            console.log('Body classes:', document.body.className);
        }
        
        // Appliquer immédiatement
        applyUserStyle();
        
        // Et aussi au chargement du DOM
        document.addEventListener('DOMContentLoaded', applyUserStyle);
    </script>
</body>

</html>
